<html>

<head>
	<title>Nicks GeoJSON Previewer</title>
	<link rel="stylesheet"
		href="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/css/ol.css" type="text/css">
	<style>
		.body{
			height: 100%;
			width: 100%;
			padding:0;
			margin:0;
			display:grid;
			grid-template-columns: auto;
		}
	</style>
	<script src="https://cdn.jsdelivr.net/gh/openlayers/openlayers.github.io@master/en/v6.4.3/build/ol.js"></script>
</head>

<body>
	<div id="map" class="map"></div>
	<script>
		var xx = new URLSearchParams(window.location.search);
		xx.delete("show");
		xx.delete("wkt");
		fetch("?" + xx.toString())
			.then(resp=>{
				if(resp.ok) return resp
				resp.text().then(txt=>document.querySelector('div').innerHTML=txt)
			})
			.then(r => r.json())
			.catch(err=>{
				console.log(err)
				document.querySelector('div').innerHTML=err.toString()
			})
			.then(GEOJSON => {

				let view = new ol.View({
					center: [12898411.077810172, -3757643.0263860035],
					zoom: 5.5,
				});

				let featureProjection = view.getProjection()
				let dataProjection = new ol.format.GeoJSON().readProjection({"crs":{"type":"EPSG","properties":{"code":4326}}})
				let read_features = new ol.format.GeoJSON({featureProjection, dataProjection}).readFeatures(GEOJSON);
				var layer_geojson = new ol.layer.Vector({
					source: new ol.source.Vector({
						features: read_features,
					}),
					style:(feature)=>{
                        console.log(feature.getGeometry().getType())
                        return new ol.style.Style({

                            stroke: new ol.style.Stroke({
                                color: '#319FD3',
                                width: 4,
                            }),
                            image: new ol.style.Circle({
                                  radius: 8,
                                  stroke: new ol.style.Stroke({color: '#319FD3', width:4}),
                                }),
                        })
                    },
				});
				
				layer_osm = new ol.layer.Tile({
					source: new ol.source.OSM()
				})

				window.map = new ol.Map({
					layers: [layer_osm, layer_geojson],
					target: 'map',
					view
				});
				let target_extent = layer_geojson.getSource().getExtent()
				let resolution = view.getResolutionForExtent(target_extent)
				let target_zoom = view.getZoomForResolution(resolution)/1.01
				let target_center = ol.extent.getCenter(target_extent)
				view.animate({
					zoom:target_zoom,
					center:target_center,
					duration: 1500,
					easing: ol.easing.easeOut
				})

			});
	</script>
</body>

</html>